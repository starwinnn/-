<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>åƒç´ æˆ˜ç—˜è®° v2.6 (è®¡æ•°æ—¥å†ç‰ˆ)</title>
<style>
    /* --- æ ¸å¿ƒæ ·å¼å˜é‡ --- */
    :root {
        --bg: #FFF8E7;
        --panel: #fff;
        --border: #332211;
        --shadow: rgba(0,0,0,0.1);
        --font-stack: 'Courier New', Courier, monospace;
    }

    body {
        background-color: var(--bg);
        font-family: var(--font-stack);
        margin: 0; padding: 10px 10px 30px 10px;
        display: flex; flex-direction: column; align-items: center;
        user-select: none; -webkit-user-select: none;
        color: #443322;
        min-height: 100vh;
    }

    /* --- é€šç”¨åƒç´ æ¡† --- */
    .pixel-box {
        background: var(--panel);
        border: 3px solid var(--border);
        box-shadow: 4px 4px 0px var(--border);
        padding: 12px; margin-bottom: 15px;
        width: 100%; max-width: 350px;
        box-sizing: border-box;
    }

    /* --- è§†å›¾åˆ‡æ¢ --- */
    .view-section { display: none; width: 100%; flex-direction: column; align-items: center; }
    .view-section.active { display: flex; }

    /* --- å¯¼èˆªæ  --- */
    .nav-bar {
        display: flex; justify-content: space-between; align-items: center;
        background: #FFECB3;
    }
    .nav-btn {
        background: #fff; border: 2px solid var(--border);
        padding: 5px 12px; cursor: pointer; font-weight: bold; font-family: inherit;
        box-shadow: 2px 2px 0 var(--border); border-radius: 4px;
    }
    .nav-btn:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0 var(--border); }
    .date-display { font-size: 1.1rem; font-weight: bold; }

    /* --- é¢éƒ¨åŒºåŸŸ --- */
    .face-container {
        position: relative; width: 280px; height: 300px;
        margin: 0 auto 15px auto; cursor: crosshair;
    }
    .pixel-face {
        width: 100%; height: 100%;
        background: #FFE0BD;
        border: 4px solid var(--border);
        border-radius: 50px 50px 30px 30px;
        box-shadow: 6px 6px 0 var(--border);
        position: relative; overflow: hidden;
    }
    /* äº”å®˜ */
    .hair-bangs { width: 100%; height: 75px; background: #3E2723; border-bottom: 4px solid var(--border); position: absolute; top: 0; left: 0; border-radius: 45px 45px 10px 10px; z-index: 5; }
    .eye { width: 24px; height: 24px; background: var(--border); position: absolute; top: 115px; border-radius: 50%; }
    .eye.l { left: 60px; } .eye.r { right: 60px; }
    .eye::after { content:''; width:8px; height:8px; background:#fff; position:absolute; top:4px; left:4px; border-radius: 50%; }
    .mouth { width: 40px; height: 12px; background: transparent; border-bottom: 4px solid var(--border); position: absolute; bottom: 70px; left: 50%; margin-left: -20px; border-radius: 50%; }
    .blush { width: 35px; height: 15px; background: #FFAB91; opacity:0.6; position: absolute; top: 145px; border-radius: 50%; }
    .blush.l { left: 35px; } .blush.r { right: 35px; }

    /* --- ç—˜ç—˜äº¤äº’ --- */
    .acne-dot {
        width: 20px; height: 20px; position: absolute;
        transform: translate(-50%, -50%);
        border: 2px solid #5a0000; border-radius: 50%;
        z-index: 10; cursor: pointer; transition: transform 0.1s;
        box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }
    .acne-dot:active { transform: translate(-50%, -50%) scale(1.2); }
    .acne-red { background: #FF4D4D; }
    .acne-white { background: #fff; border-color: #cc0000; }
    .acne-mark { background: #CE93D8; border-color: #6A1B9A; opacity: 0.9; }

    /* --- æŒ‡å—ä¸ç»Ÿè®¡ --- */
    .instruction-panel h4 { margin: 0 0 10px 0; text-align: center; border-bottom: 2px dashed #ccc; padding-bottom: 5px; }
    .lifecycle-steps { font-size: 0.85rem; display: flex; flex-direction: column; gap: 8px; }
    .step-item { display: flex; align-items: center; }
    .step-icon { font-size: 1.2rem; margin-right: 8px; }
    
    .stats-panel { font-size: 0.9rem; background: #EFEBE9; }
    .stat-row { display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding: 6px 0; }
    .stat-row:last-child { border-bottom: none; }

    /* --- åº•éƒ¨å·¥å…· --- */
    .tools { display: flex; gap: 10px; margin-top: 5px; max-width: 350px; width: 100%; }
    .tool-btn { flex: 1; padding: 12px; border: 3px solid var(--border); font-family: inherit; font-size: 0.9rem; font-weight: bold; cursor: pointer; border-radius: 8px; box-shadow: 3px 3px 0 var(--border); }
    .tool-btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0 var(--border); }
    .btn-cal { background: #BBDEFB; color: #0D47A1; }
    .btn-save { background: #FFCDD2; color: #BF360C; }

    /* --- æ—¥å†ç•Œé¢æ ·å¼ (å‡çº§ç‰ˆ) --- */
    .calendar-container { width: 100%; max-width: 360px; }
    .calendar-header {
        text-align: center; margin-bottom: 15px; font-size: 1.2rem; font-weight: bold;
        background: #fff; padding: 10px; border: 3px solid var(--border); box-shadow: 4px 4px 0 var(--border);
    }
    .year-grid {
        display: flex; flex-direction: column; gap: 15px;
        height: 70vh; overflow-y: auto; padding-right: 5px;
    }
    .month-card { background: #fff; border: 2px solid var(--border); padding: 10px; box-shadow: 2px 2px 0 rgba(0,0,0,0.1); }
    .month-title { font-weight: bold; border-bottom: 2px dashed #ddd; margin-bottom: 5px; text-align: center; }
    .days-grid {
        display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; text-align: center;
    }
    
    /* æ—¥å†æ ¼å­æ ·å¼å‡çº§ */
    .day-cell {
        aspect-ratio: 1; display: flex; flex-direction: column; /* çºµå‘æ’åˆ—æ—¥æœŸå’Œæ•°å­— */
        align-items: center; justify-content: center;
        background: #f0f0f0; cursor: pointer; border-radius: 2px;
        position: relative;
    }
    .day-cell.empty { background: transparent; cursor: default; }
    
    .day-num { font-size: 0.75rem; color: #555; } /* æ—¥æœŸæ•°å­— */
    
    /* å…·ä½“çš„ç—˜ç—˜ä¸ªæ•°æ ‡ */
    .acne-count-tag {
        font-size: 0.6rem; 
        font-weight: bold;
        background: rgba(255,255,255,0.6);
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 4px;
        padding: 0 3px;
        margin-top: 1px;
        color: #000;
        min-width: 10px;
    }

    /* çƒ­åŠ›å›¾é¢œè‰² */
    .lvl-0 { background: #fff; }
    .lvl-1 { background: #C8E6C9; border: 1px solid #81C784; } /* ç»¿ */
    .lvl-2 { background: #FFE0B2; border: 1px solid #FFB74D; } /* æ©™ */
    .lvl-3 { background: #FFCDD2; border: 1px solid #E57373; } /* çº¢ */

    .back-btn-wrapper { margin-top: 15px; width: 100%; }
    .btn-back { width: 100%; background: #E0E0E0; }

</style>
</head>
<body>

    <div id="mainView" class="view-section active">
        <div class="pixel-box nav-bar">
            <button class="nav-btn" onclick="changeDate(-1)">â—€ å‰ä¸€å¤©</button>
            <div class="date-display" id="currentDate">LOADING...</div>
            <button class="nav-btn" onclick="changeDate(1)">åä¸€å¤© â–¶</button>
        </div>

        <div class="face-container">
            <div class="pixel-face" id="faceBoard">
                <div class="hair-bangs"></div> <div class="eye l"></div><div class="eye r"></div>
                <div class="blush l"></div><div class="blush r"></div> <div class="mouth"></div>
            </div>
        </div>

        <div class="pixel-box instruction-panel" style="background: #E3F2FD;">
            <h4>ğŸ“– æˆ˜ç—˜æŒ‡å— (ç‚¹å‡»ç—˜ç—˜åˆ‡æ¢çŠ¶æ€)</h4>
            <div class="lifecycle-steps">
                <div class="step-item"><span class="step-icon">ğŸ‘‡ Ã— 1</span> ğŸ”´ çº¢è‚¿ (åˆšé•¿å‡ºæ¥)</div>
                <div class="step-item"><span class="step-icon">ğŸ‘‡ Ã— 2</span> âšª ç™½å¤´ (æˆç†Ÿäº†)</div>
                <div class="step-item"><span class="step-icon">ğŸ‘‡ Ã— 3</span> ğŸŸ£ ç—˜å° (æ„ˆåˆæœŸ)</div>
                <div class="step-item"><span class="step-icon">ğŸ‘‡ Ã— 4</span> ğŸ—‘ï¸ åˆ é™¤ (å½»åº•æ¶ˆå¤±)</div>
            </div>
        </div>

        <div class="pixel-box stats-panel">
            <div id="statsContent"></div>
        </div>

        <div class="tools">
            <button class="tool-btn btn-cal" onclick="showCalendar()">ğŸ“… æŸ¥çœ‹å¹´å†</button>
            <button class="tool-btn btn-save" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæœ¬æ—¥</button>
        </div>
    </div>

    <div id="calendarView" class="view-section" style="display:none;">
        <div class="calendar-container">
            <div class="calendar-header" id="calYearTitle">æˆ˜ç—˜å¹´å†</div>
            <div class="year-grid" id="yearGrid"></div>
            <div class="back-btn-wrapper">
                <button class="tool-btn btn-back" onclick="showMain()">ğŸ”™ è¿”å›è®°å½•ç•Œé¢</button>
            </div>
        </div>
    </div>

<script>
    const STORAGE_KEY = 'pixel_acne_v2';
    let allData = {}; 
    let currentDateStr = '';

    function init() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) { try { allData = JSON.parse(saved); } catch(e) { allData = {}; } }
        setDate(new Date());
    }

    // --- è§†å›¾åˆ‡æ¢ ---
    function showCalendar() {
        document.getElementById('mainView').style.display = 'none';
        document.getElementById('calendarView').style.display = 'flex';
        renderCalendar();
    }
    function showMain() {
        document.getElementById('calendarView').style.display = 'none';
        document.getElementById('mainView').style.display = 'flex';
        renderFace(); renderStats();
    }

    // --- æ—¥æœŸå¤„ç† ---
    function setDate(dateObj) {
        const y = dateObj.getFullYear();
        const m = String(dateObj.getMonth() + 1).padStart(2, '0');
        const d = String(dateObj.getDate()).padStart(2, '0');
        currentDateStr = `${y}-${m}-${d}`;
        document.getElementById('currentDate').innerText = currentDateStr;
        renderFace(); renderStats();
    }
    function changeDate(delta) {
        const parts = currentDateStr.split('-');
        const current = new Date(parts[0], parts[1]-1, parts[2]);
        current.setDate(current.getDate() + delta);
        setDate(current);
    }

    // --- é¢éƒ¨é€»è¾‘ ---
    function renderFace() {
        document.querySelectorAll('.acne-dot').forEach(el => el.remove());
        const list = allData[currentDateStr] || [];
        const face = document.getElementById('faceBoard');
        list.forEach((pt, idx) => {
            const dot = document.createElement('div');
            let cls = 'acne-red';
            if(pt.state===1) cls='acne-white';
            if(pt.state===2) cls='acne-mark';
            dot.className = `acne-dot ${cls}`;
            dot.style.left = pt.x + '%'; dot.style.top = pt.y + '%';
            dot.onclick = (e) => { e.stopPropagation(); cyclePoint(idx); };
            face.appendChild(dot);
        });
    }

    document.getElementById('faceBoard').onclick = function(e) {
        if(e.target.className.includes('acne-dot')) return;
        const r = this.getBoundingClientRect();
        const x = (e.clientX - r.left)/r.width*100;
        const y = (e.clientY - r.top)/r.height*100;
        if(x<0||x>100||y<0||y>100) return;
        
        let z = 'é¢ä¸­';
        if(y<35) z='é¢å¤´'; else if(y>80) z='ä¸‹å·´';
        else if(x<35) z='å³è„¸'; else if(x>65) z='å·¦è„¸';
        else if(y>60) z='å˜´å‘¨'; else z='é¼»å­';

        if(!allData[currentDateStr]) allData[currentDateStr]=[];
        allData[currentDateStr].push({x,y,zone:z,state:0});
        save(); renderFace(); renderStats();
    };

    function cyclePoint(idx) {
        const list = allData[currentDateStr];
        list[idx].state++;
        if(list[idx].state > 2) list.splice(idx,1);
        save(); renderFace(); renderStats();
    }

    function renderStats() {
        const list = allData[currentDateStr] || [];
        const zones = {};
        list.forEach(p => zones[p.zone]=(zones[p.zone]||0)+1);
        let maxZ='æ— ', maxV=0;
        for(let z in zones) if(zones[z]>maxV){ maxV=zones[z]; maxZ=z; }
        document.getElementById('statsContent').innerHTML = `
            <div class="stat-row"><span>ğŸ“… ä»Šæ—¥æ€»æ•°</span><b>${list.length} é¢—</b></div>
            <div class="stat-row"><span>âš ï¸ é‡ç¾åŒº</span><b>${maxZ} (${maxV})</b></div>
        `;
    }
    
    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(allData)); }
    function clearData() { if(confirm('æ¸…ç©ºä»Šæ—¥?')) { allData[currentDateStr]=[]; save(); renderFace(); renderStats(); } }

    // --- æ—¥å†é€»è¾‘ (å«è®¡æ•°) ---
    function renderCalendar() {
        const grid = document.getElementById('yearGrid');
        grid.innerHTML = '';
        const year = parseInt(currentDateStr.split('-')[0]) || new Date().getFullYear();
        document.getElementById('calYearTitle').innerText = `${year}å¹´ æˆ˜ç—˜å¹´å†`;
        const months = ["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"];

        months.forEach((mName, idx) => {
            const mCard = document.createElement('div');
            mCard.className = 'month-card';
            mCard.innerHTML = `<div class="month-title">${mName}</div>`;
            const dGrid = document.createElement('div');
            dGrid.className = 'days-grid';

            const firstDay = new Date(year, idx, 1).getDay();
            const totalDays = new Date(year, idx+1, 0).getDate();

            for(let i=0; i<firstDay; i++) {
                dGrid.appendChild(Object.assign(document.createElement('div'), {className:'day-cell empty'}));
            }

            for(let d=1; d<=totalDays; d++) {
                const dateKey = `${year}-${String(idx+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const count = allData[dateKey] ? allData[dateKey].length : 0;
                
                const cell = document.createElement('div');
                let lvl = 'lvl-0';
                if(count>0 && count<=2) lvl='lvl-1';
                else if(count>2 && count<=5) lvl='lvl-2';
                else if(count>5) lvl='lvl-3';

                cell.className = `day-cell ${lvl}`;
                
                // --- è¿™é‡Œæ˜¯ä¿®æ”¹çš„æ ¸å¿ƒï¼šæ˜¾ç¤ºæ—¥æœŸå’Œå…·ä½“çš„æ•°é‡ ---
                let html = `<span class="day-num">${d}</span>`;
                if(count > 0) {
                    html += `<span class="acne-count-tag">${count}</span>`;
                }
                cell.innerHTML = html;

                cell.onclick = () => {
                    currentDateStr = dateKey;
                    document.getElementById('currentDate').innerText = currentDateStr;
                    showMain();
                };
                dGrid.appendChild(cell);
            }
            mCard.appendChild(dGrid);
            grid.appendChild(mCard);
        });
    }

    init();
</script>
</body>
</html>